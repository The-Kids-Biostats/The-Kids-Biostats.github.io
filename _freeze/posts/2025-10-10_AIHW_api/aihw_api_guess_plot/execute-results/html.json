{
  "hash": "c7871ee142584987838a4d776ea378be",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Accessing national health data via API\"\nauthor: \"Dr Matt Cooper and Dr Haileab Wolde\"\nformat:\n  html:\n    code-fold: true\n    tabset: true\n    toc: true\n    toc-location: left\ndate: \"2025-10-20\"\ncategories:\n  - R\n  - AIHW\n  - Guess that plot\ndraft: false\ncss: _extensions/html/styles.css\neditor_options: \n  chunk_output_type: console\nexecute:\n  echo: false\n  warning: false \nfig-align: center\nfig-format: png\n---\n\n\n# Overview\n\nDid you know, the [Australian Institute of Health and Welfare](https://www.aihw.gov.au/) (AIHW) is a treasure trove of **available** health data?\n\nThe AIHW works with a range of stakeholders from across Australia to carry out high-quality research covering a broad range of health domains; they also produce many reports each year contextualising the state of the nation's health. While the data that supports these reports is often available for download from their website *(.xslx, .csv)*, a range of the data can can also by accessed via Application Programming Interface (API). The [MyHospitals API](https://www.aihw.gov.au/hospitals/other-resources/myhospitals-api) opens the door to automated, real-time access, and offers much greater flexibility in how you explore and analyse the data.\n\nIn this post, weâ€™ll demonstrate---as an example---how to access emergency department presentation (ED) data for major hospitals here in Western Australia, process it in R, and create an insightful visualisation.\n\n![All 4 \"Guess The Plots\" Together](images/all4.png){#fig-source width=\"100%\" align=\"center\"}\n\n![The final plot](images/fig4.png){#fig-source width=\"100%\" align=\"center\"}\n\n# Diving in!\n\nThere are many ways to access data via API using R; for example, you might look to combine the [`httr`](https://cran.r-project.org/web/packages/httr/index.html) package with the [`jsonlite`](https://cran.r-project.org/web/packages/jsonlite/index.html) package to build your own query. Instead, we're going to leverage the great work that has already been done in the [`readaihw`](https://github.com/RWParsons/readaihw) package to dive right in without getting too technical from a data request and restructuring perspective. With just a few steps, we've got the data that we are after!\n\n1.  Load [our package](https://github.com/The-Kids-Biostats/thekidsbiostats) and the `readaihw` package [(installed from github)](https://github.com/RWParsons/readaihw).\n2.  Use the `read_flat_data_extract()` to source the `\"MYH-ED\"`.\n3.  Use the `get_hospital_mappings()` function to source metadata for the hospitals; then reducing this dataset to just what we're interested in.\n4.  Some further data processing (filtering, variable manipulation, aggregation) prior to joining the two datasets together.\n\n*Expanding on these four steps above. In Step 2, we use the `read_flat_data_extract()` function from the `readaihw` package to retrieve ED presentation data for hospitals in Western Australia. This function simplifies API access and returns a tidy data frame ready for analysis. The `MYH-ED` code specifies that we are asking for the count of monthly ED presentations across hospitals in Australia. Other key columns in this dataset include: `reporting_unit_code` (unique hospital identifier), `date` (month and year of the record), `value` (number of ED presentations). In Step 2, while the returned API call includes data from many other hospitals and locations, we just want to focus on key metropolitan hospitals in Western Australia, so we filter the dataset using hospital codes and names. We also join geographic coordinates to each hospital so we can later include inset maps.*\n\n*This gives us a clean dataset ready for plotting and mapping.*\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\n# Step 1\nlibrary(thekidsbiostats)\nlibrary(readaihw)\n\n# Step 2\ned_presentations <- read_flat_data_extract(measure_category_code = \"MYH-ED\")\n\n# Step 3\nmsh_hospital_codes <- get_hospital_mappings() |>\n  filter(state == \"Western Australia\",\n         type == \"Hospital\") |>\n  filter(name %in% c(\"Perth Children's Hospital\",\n                     \"Fiona Stanley Hospital\",\n                     \"Sir Charles Gairdner Hospital\",\n                     \"Joondalup Health Campus (Public)\",\n                     \"Royal Perth Hospital Wellington Street Campus\")) |>\n  select(code, latitude, longitude)\n\n# Step 4\nmy_aihw_dat <- ed_presentations |>\n  filter(reporting_unit_code %in% msh_hospital_codes$code) |>\n  select(reporting_unit_code, \n         date = reporting_end_date, \n         hospital = reporting_unit_name, \n         value) |>\n  mutate(value = as.numeric(value), \n         date = lubridate::ymd(date)) |>\n  group_by(hospital, date) |> \n  summarize(count = sum(value, na.rm = TRUE),\n            code = reporting_unit_code[1]) |> \n  left_join(msh_hospital_codes, by = join_by(code == code))\n\n# Let's have a look  \nmy_aihw_dat |> \n  head(10) |> \n  thekids_table(colour = \"AzureBlue\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-ff76ed92{table-layout:auto;}.cl-ff6e36d4{font-family:'Barlow';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-ff6e36de{font-family:'Barlow';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 25, 33, 1.00);background-color:transparent;}.cl-ff71605c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2.5pt;padding-top:2.5pt;padding-left:2.5pt;padding-right:2.5pt;line-height: 1.5;background-color:transparent;}.cl-ff716070{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2.5pt;padding-top:2.5pt;padding-left:2.5pt;padding-right:2.5pt;line-height: 1.5;background-color:transparent;}.cl-ff717dee{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717df8{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e02{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e03{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e04{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e0c{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e0d{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e0e{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e0f{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e16{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e17{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e18{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e20{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e2a{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e2b{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e2c{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e2d{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ff717e2e{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-ff76ed92'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-ff717dee\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36d4\">hospital</span></p></th><th class=\"cl-ff717df8\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36d4\">date</span></p></th><th class=\"cl-ff717e02\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36d4\">count</span></p></th><th class=\"cl-ff717e03\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36d4\">code</span></p></th><th class=\"cl-ff717e04\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36d4\">latitude</span></p></th><th class=\"cl-ff717e0c\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36d4\">longitude</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2015â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">39571</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2016â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">103234</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2017â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">101901</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2018â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">107041</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2019â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">110553</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2020â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">105122</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2021â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">110029</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2022â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">112678</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e0d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e0e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2023â€‘06â€‘30</span></p></td><td class=\"cl-ff717e0f\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">107770</span></p></td><td class=\"cl-ff717e16\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e17\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e18\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ff717e20\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">Fiona Stanley Hospital</span></p></td><td class=\"cl-ff717e2a\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">2024â€‘06â€‘30</span></p></td><td class=\"cl-ff717e2b\"><p class=\"cl-ff716070\"><span class=\"cl-ff6e36de\">111145</span></p></td><td class=\"cl-ff717e2c\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">H0746</span></p></td><td class=\"cl-ff717e2d\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">â€‘32.070120</span></p></td><td class=\"cl-ff717e2e\"><p class=\"cl-ff71605c\"><span class=\"cl-ff6e36de\">115.846909</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n## Where did the `\"MYH-ED\"` code come from?\n\nGreat question!\n\nThere are many different variables that can be sourced. You can find a [descriptive list online](https://www.aihw.gov.au/about-our-data/our-data-collections), but we can also use the API (and some of those packages mentioned earlier) to import the list of codes directly into R!\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"show\"}\nlibrary(httr)\nlibrary(jsonlite)\n\nmeasures <- GET(\"https://myhospitalsapi.aihw.gov.au/api/v1/Measures\")\nmeasures <- content(measures, as = \"text\")\nmeasures <- fromJSON(measures, flatten = TRUE)\nmeasures$result |> \n  select(measure_code, measure_name) |> \n  head(10) |> \n  thekids_table(colour = \"AzureBlue\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-ffb62a2a{table-layout:auto;}.cl-ffae7744{font-family:'Barlow';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(255, 255, 255, 1.00);background-color:transparent;}.cl-ffae774e{font-family:'Barlow';font-size:10pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(17, 25, 33, 1.00);background-color:transparent;}.cl-ffb15c0c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:2.5pt;padding-top:2.5pt;padding-left:2.5pt;padding-right:2.5pt;line-height: 1.5;background-color:transparent;}.cl-ffb171a6{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171b0{background-color:rgba(66, 110, 168, 1.00);vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171b1{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171ba{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171bb{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171c4{background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171c5{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-ffb171ce{background-color:transparent;vertical-align: middle;border-bottom: 1pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-ffb62a2a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-ffb171a6\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae7744\">measure_code</span></p></th><th class=\"cl-ffb171b0\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae7744\">measure_name</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171b1\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0001</span></p></td><td class=\"cl-ffb171ba\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Number of surgeries for malignant cancer</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0002</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Median waiting time for surgery for malignant cancer</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0003</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of people who received surgery for malignant cancer within 30 days</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0004</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of people who received surgery for malignant cancer within 45 days</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0005</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of patients who depart the emergency department within four hours of arrival</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171b1\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0006</span></p></td><td class=\"cl-ffb171ba\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Number of elective surgeries</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0007</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of patients who waited longer than 365 days for elective surgery</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0008</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of patients who received their surgery within clinically recommended times</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171bb\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0009</span></p></td><td class=\"cl-ffb171c4\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Median waiting time for elective surgery</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-ffb171c5\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">MYH0010</span></p></td><td class=\"cl-ffb171ce\"><p class=\"cl-ffb15c0c\"><span class=\"cl-ffae774e\">Percentage of patients who commenced treatment within the recommended time</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\nFrom here, the world *(of AIHW MyHospital data)* is your oyster!\n\n# Extended example - Guess. That. Plot!\n\nEvery so often, on one of our internal communication platforms, we'll do a little 'Guess That Plot' quiz. It's a fun way to engage staff from around [our Institute](https://www.thekids.org.au/) in some conversation and critical thinking around data and visualisations. And it possibly goes without saying---the above plot is indeed a recent example of one of these 'Guess That Plot' quizzes we did where we used AIHW data!\n\nThe code for this is below.\n\n## But first, some notes ...\n\nFor something a little different, we inset a map of Perth into these plots with a marker for the *point of interest*. This involves using the [`ggmaps`](https://cran.r-project.org/web/packages/ggmap/index.html) package and [registering here](https://client.stadiamaps.com/signup/) at Stadia Maps for a free account to receive a `token` to allow us to access the map tile images.\n\nWe obviously can't share our token; the full `.qmd` for this post won't run until you update the code with your own token. For that reason, we insert `.png`s of the figures that were saved earlier.\n\n*Now we will create a base map of the Perth area and define a function to generate small inset maps for each hospital. Each inset will mark a hospitalâ€™s location with a red star on the map. These inset maps can be added to other plots to visually show the exact location of each hospital, while keeping the map clean and free of axes or labels.*\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nlibrary(ggmap)\nlibrary(patchwork)\n\nregister_stadiamaps(\"YOUR-TOKEN-GOES-HERE\", write = FALSE)\n\n# Define the Perth area\nperth_bbox <- c(left = 115.65, bottom = -32.1, right = 115.95, top = -31.70)\n\n# Source the map tiles for the area we need\nperth_map <- get_stadiamap(\n  bbox = as.matrix(perth_bbox),\n  maptype = \"stamen_terrain_background\"\n)\n\n# Form a grob object of the map that we will reuse in each plot\ninset_map <- function(latitude, longitude) {\n  latitude <- as.numeric(latitude)\n  longitude <- as.numeric(longitude)\n  \n  ggplotGrob(\n    ggmap(perth_map) +\n      annotate(\"point\", x = longitude, y = latitude,\n        color = \"red\", size = 3, shape = 8) +\n      theme_void())}\n```\n:::\n\n\nIn addition:\n\n-   We use an `lapply` to iterate over each hospital. Typically, we might look to `purrr::map` or other functions from the `tidyverse` for tasks like this. **We acknowledge here that AI assisted with some of the code here.**\n-   We use `wrap_plots()` from the `patchwork` package to assemble the figures. We originally looked at using `facet_wrap()` (or similar) from the `ggplot2` package, but this proved quite challenging when incorporating the inset map with varying red X marker.\n-   We use white text on a white background, as opposed to `element_blank()` because it keeps all dimensions of the plots consistent as we work through to the reveal! This is really important so plot elements don't change relative size and position!\n\n## Figure 1: Not much to go off!\n\nThis plot only shows the time series where both x- and y-axis labels and hospital names are hidden, but perhaps the markings on the maps are a hint? Particularly if you remember which year certain hospitals opened...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhospital_plots <- lapply(split(my_aihw_dat, my_aihw_dat$hospital), function(df) {\n  \n  lat <- df$latitude[1]\n  lon <- df$longitude[1]\n  \n  ts_plot <- ggplot(df, aes(date, count)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(labels = scales::label_comma(), limits = c(0, 120000)) +\n    scale_x_date(date_breaks = \"2 years\", date_labels = \"%Y\",\n                 limits = c(as.Date(\"2013-01-01\"), as.Date(\"2024-12-31\"))) +\n    theme_thekids() +\n    theme(axis.line = element_line(),\n          axis.ticks = element_line(),\n          axis.text = element_text(colour = \"white\")) +\n    labs(x = NULL, y = \" \", title = \" \")\n  \n  ts_plot + inset_element(\n    inset_map(lat, lon),\n    left = 0.8, right = 1,\n    bottom = 0.02, top = 0.55\n  ) \n})\n\nfig1 <- wrap_plots(hospital_plots, ncol = 2) +\n  plot_annotation(caption = \" \")\n```\n:::\n\n\n![Reveal 1](images/fig1.png){#fig-source width=\"80%\" align=\"center\"}\n\n## Figure 2: Time Series with x-axis Labels\n\nSimilar to Figure 1, but the x-axis labels are visible, allowing the timeline to be interpreted while keeping the y-axis blank.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhospital_plots <- lapply(split(my_aihw_dat, my_aihw_dat$hospital), function(df) {\n  \n  lat <- df$latitude[1]\n  lon <- df$longitude[1]\n  \n  ts_plot <- ggplot(df, aes(date, count)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(labels = scales::label_comma(), limits = c(0, 120000)) +\n    scale_x_date(date_breaks = \"2 years\", date_labels = \"%Y\",\n                 limits = c(as.Date(\"2013-01-01\"), as.Date(\"2024-12-31\"))) +\n    theme_thekids() +\n    theme(axis.line = element_line(),\n          axis.ticks = element_line(),\n          axis.text.y = element_text(colour = \"white\")) +\n    labs(x = NULL, y = \" \", title = \" \")\n  \n  ts_plot + inset_element(\n    inset_map(lat, lon),\n    left = 0.8, right = 1,\n    bottom = 0.02, top = 0.55\n  ) \n})\n\nfig2 <- wrap_plots(hospital_plots, ncol = 2) +\n  plot_annotation(caption = \" \")\n```\n:::\n\n\n![Reveal 2](images/fig2.png){#fig-source width=\"80%\" align=\"center\"}\n\n## Figure 3: Time Series with Caption\n\nThis version includes visible axes and ticks, making the data easier to interpret. A caption indicating the data source (`AIHW API`) is added as a real nudge to what the data might be. Hospital names are still hidden.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhospital_plots <- lapply(split(my_aihw_dat, my_aihw_dat$hospital), function(df) {\n  \n  lat <- df$latitude[1]\n  lon <- df$longitude[1]\n  \n  ts_plot <- ggplot(df, aes(date, count)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(labels = scales::label_comma(), limits = c(0, 120000)) +\n    scale_x_date(date_breaks = \"2 years\", date_labels = \"%Y\",\n                 limits = c(as.Date(\"2013-01-01\"), as.Date(\"2024-12-31\"))) +\n    theme_thekids() +\n    theme(axis.line = element_line(),\n          axis.ticks = element_line()) +\n    labs(x = NULL, y = \" \", title = \" \")\n  \n  ts_plot + inset_element(\n    inset_map(lat, lon),\n    left = 0.8, right = 1,\n    bottom = 0.02, top = 0.55\n  ) \n})\n\nfig3 <- wrap_plots(hospital_plots, ncol = 2) +\n  plot_annotation(caption = \"Data source: AIHW API, code: 'XXX-XX'\")\n```\n:::\n\n\n![Reveal 3](images/fig3.png){#fig-source width=\"80%\" align=\"center\"}\n\n## Figure 4: The reveal!\n\nAnd here, everything is revealed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhospital_plots <- lapply(split(my_aihw_dat, my_aihw_dat$hospital), function(df) {\n  \n  lat <- df$latitude[1]\n  lon <- df$longitude[1]\n  \n  ts_plot <- ggplot(df, aes(date, count)) +\n    geom_line() +\n    geom_point() +\n    scale_y_continuous(labels = scales::label_comma(), limits = c(0, 120000)) +\n    scale_x_date(date_breaks = \"2 years\", date_labels = \"%Y\",\n                 limits = c(as.Date(\"2013-01-01\"), as.Date(\"2024-12-31\"))) +\n    theme_thekids() +\n    theme(axis.line = element_line(),\n          axis.ticks = element_line()) +\n    labs(x = NULL, y = \"ED Presentations (n)\", title = unique(df$hospital))\n  \n  ts_plot + inset_element(\n    inset_map(lat, lon),\n    left = 0.8, right = 1,\n    bottom = 0.02, top = 0.55\n  ) \n})\n\nfig4 <- wrap_plots(hospital_plots, ncol = 2)  +\n  plot_annotation(caption = \"Data source: AIHW API, code: 'MYH-ED'\")\n```\n:::\n\n\n![The final reveal](images/fig4.png){#fig-source width=\"100%\" align=\"center\"}\n\n## Putting them all together\n\nPutting these four stages of the reveal together also posed a few challenges, namely combining multiple plots that *themselves* were assembled with `patchwork`.\n\nFor this, we again turned to AI, and the resulting code is available below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Divider \"plots\" (vertical and horizontal)\nv_thickness <- 0.005  # fraction of width for vertical divider (adjust)\nh_thickness <- 0.01  # fraction of height for horizontal divider (adjust)\n\ndivider_v <- ggplot() +\n  theme_void() +\n  theme(plot.background = element_rect(fill = \"black\", colour = NA))\n\ndivider_h <- divider_v  # same look for horizontal divider\n\n# Make rows with a vertical divider between plots\ntop_row <- wrap_plots(p1, divider_v, p2, ncol = 3, widths = c(1, v_thickness, 1))\nbottom_row <- wrap_plots(p3, divider_v, p4, ncol = 3, widths = c(1, v_thickness, 1))\n\n# Combine rows with a horizontal divider between them\nfinal <- wrap_plots(top_row, divider_h, bottom_row, \n                    ncol = 1, heights = c(1, h_thickness, 1)) +\n  plot_layout(ncol = 1) \n\nfinal\n\nggsave(paste0(Sys.Date(), \"_fig1-4.png\"),\n       width = 20, height = 10)\n```\n:::\n\n\n![All 4 Guess The Plots Together](images/all4.png){#fig-source width=\"100%\" align=\"center\"}\n\n# Closing comments\n\nAccessing health data via the AIHW API opens up many possibilities for data analysis and visualisations to help us understand trends in Australian Health Statistics. Perhaps it may even contain informative data to aid in one's own study planning! The `readaihw` package puts this data at the fingertips of any R user, reducing the barriers to diving in and exploring this data. The figures shown here are not overly polished---as that wasn't the purpose of this post. However, hopefully we've shown how easy it can be to draw some interesting local insights while having a bit of fun along the way.\n\n## Acknowledgements\n\nThanks to Zac Dempsey, Robin Cook, Elizabeth McKinnon, and Wes Billingham for providing feedback on and reviewing this post.\n\n## Reproducibility Information\n\nThe session information can also be seen below.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.0 (2025-04-11 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n  LAPACK version 3.12.1\n\nlocale:\n[1] LC_COLLATE=English_Australia.utf8  LC_CTYPE=English_Australia.utf8   \n[3] LC_MONETARY=English_Australia.utf8 LC_NUMERIC=C                      \n[5] LC_TIME=English_Australia.utf8    \n\ntime zone: Australia/Sydney\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] jsonlite_2.0.0        httr_1.4.7            readaihw_0.0.2       \n [4] thekidsbiostats_1.4.3 extrafont_0.20        flextable_0.9.10     \n [7] gtsummary_2.4.0       lubridate_1.9.4       forcats_1.0.1        \n[10] stringr_1.5.2         dplyr_1.1.4           purrr_1.1.0          \n[13] readr_2.1.5           tidyr_1.3.1           tibble_3.3.0         \n[16] ggplot2_4.0.0         tidyverse_2.0.0      \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6            httr2_1.2.1             xfun_0.53              \n [4] htmlwidgets_1.6.4       tzdb_0.5.0              vctrs_0.6.5            \n [7] tools_4.5.0             generics_0.1.4          curl_7.0.0             \n[10] pkgconfig_2.0.3         data.table_1.17.8       RColorBrewer_1.1-3     \n[13] S7_0.2.0                readxl_1.4.5            assertthat_0.2.1       \n[16] uuid_1.2-1              lifecycle_1.0.4         compiler_4.5.0         \n[19] farver_2.1.2            textshaping_1.0.4       janitor_2.2.1          \n[22] snakecase_0.11.1        httpuv_1.6.16           fontquiver_0.2.1       \n[25] fontLiberation_0.1.0    htmltools_0.5.8.1       yaml_2.3.10            \n[28] Rttf2pt1_1.3.14         extrafontdb_1.1         later_1.4.4            \n[31] pillar_1.11.1           openssl_2.3.4           mime_0.13              \n[34] fontBitstreamVera_0.1.1 tidyselect_1.2.1        zip_2.3.3              \n[37] digest_0.6.37           stringi_1.8.7           labelled_2.15.0        \n[40] fastmap_1.2.0           grid_4.5.0              cli_3.6.5              \n[43] magrittr_2.0.4          patchwork_1.3.2         withr_3.0.2            \n[46] rappdirs_0.3.3          gdtools_0.4.4           scales_1.4.0           \n[49] promises_1.3.3          timechange_0.3.0        rmarkdown_2.30         \n[52] officer_0.7.0           cellranger_1.1.0        askpass_1.2.1          \n[55] ragg_1.5.0              hms_1.1.4               shiny_1.11.1           \n[58] evaluate_1.0.5          knitr_1.50              haven_2.5.5            \n[61] rlang_1.1.6             Rcpp_1.1.0              xtable_1.8-4           \n[64] glue_1.8.0              xml2_1.4.0              rstudioapi_0.17.1      \n[67] R6_2.6.1                systemfonts_1.3.1       fs_1.6.6               \n[70] shinyFiles_0.9.3       \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}